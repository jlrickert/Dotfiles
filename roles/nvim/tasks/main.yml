---
- name: Remove bat to prevent dependency issues (Ubuntu)
  become: true
  ansible.builtin.apt:
      name: bat
      state: absent
  when: ansible_distribution == "Ubuntu"

- name: Install nvim (Linux)
  import_tasks: linux.yml
  when: ansible_distribution in ["Ubuntu", "Fedora", "Archlinux"]

- name: Install pynvim
  ansible.builtin.pip:
      name:
          - pynvim
      state: present
      executable: pip3

- name: Install packer packages
  shell:
      cmd: nvim --headless -c 'PackerUpdate' -c quit
  changed_when: false

- name: Install mason packages
  shell:
      cmd: nvim --headless -c 'MasonUpdate' -c quit
  changed_when: false

- name: Install treesitter parsers
  shell:
      cmd: nvim --headless -c 'TSInstallSync! {{ parsers | join(" ") }}' -c quit
  vars:
      parsers:
          - astro
          - bash
          - c
          - cpp
          - diff
          - go
          - html
          - javascript
          - jsdoc
          - json
          - jsonc
          - lua
          - markdown
          - markdown_inline
          - python
          - rust
          - scss
          - svelte
          - toml
          - tsx
          - typescript
          - vim
          - yaml
  changed_when: false
