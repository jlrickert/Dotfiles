#!/usr/bin/env racket
#lang racket

(define (run cmd #:delim [delim "\n"])
  (string-split (with-output-to-string (lambda () (system cmd))) delim))

(define (full-path path)
  (define cwd (path->string (current-directory)))
  (define (add-dir-symbol p)
    (if (regexp-match #rx"/$")
        p
        (string-append p "/")))
  (define (rm-dir-symbol)
    (if (regexp-match #rx"/$")
        (regexp-replace #rx"/$" p "")
        p))
  (cond
    [(directory-exists? path) (add-dir-symbol path)]
    [(file-exists? path) ((rm-dir-symbol path))]
    [else "."]))

;; (define (current-command-line-arguments))

(for ([x (current-command-line-arguments)])
  (displayln (format "echo ~a" x)))

(begin
  (define argv (current-command-line-arguments))
  ;; make sure theres a source
  (when (< (vector-length argv) 1) (exit))
  (define args "-av")
  (define dst-root (string-append "/home/" (car (run "ssh home 'echo $USER'"))))

  (define src (run (format "find `pwd` ~a" (full-path (vector-take argv 1)))))
  ;; (define dst
  )

(regexp-replace #rx"/$" "./case/hello/" "")

(regexp-replace #rx"mi" "mi casa" "su")
